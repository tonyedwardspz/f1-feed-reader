<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html"> 
<link rel="import" href="../../bower_components/byutv-jsonp/byutv-jsonp.html">

<dom-module id="feed-list">
  <template>
      <iron-ajax
    auto
    url="http://open-elements.org/rss.xml"
    handle-as="xml" last-response="{{data}}"></iron-ajax>

    <template is="dom-repeat" items="{{dataList}}">
      <h1>{{item.title.#text}}</h1>
      <span>{{item.description.#text}}</span>
    </template>

  </template>

</dom-module>
  <script>
    var gdata
    function xmlToJson(xml) {
  
  // Create the return object
  var obj = {};

  if (xml.nodeType == 1) { // element
    // do attributes
    if (xml.attributes.length > 0) {
    obj["@attributes"] = {};
      for (var j = 0; j < xml.attributes.length; j++) {
        var attribute = xml.attributes.item(j);
        obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
      }
    }
  } else if (xml.nodeType == 3) { // text
    obj = xml.nodeValue;
  }

  // do children
  if (xml.hasChildNodes()) {
    for(var i = 0; i < xml.childNodes.length; i++) {
      var item = xml.childNodes.item(i);
      var nodeName = item.nodeName;
      if (typeof(obj[nodeName]) == "undefined") {
        obj[nodeName] = xmlToJson(item);
      } else {
        if (typeof(obj[nodeName].push) == "undefined") {
          var old = obj[nodeName];
          obj[nodeName] = [];
          obj[nodeName].push(old);
        }
        obj[nodeName].push(xmlToJson(item));
      }
    }
  }
  return obj;
};
    Polymer({
      is: "feed-list",
       properties: {
         data: {
         },
         dataList: {
           computed:"datalog(data)"
         }
      },
      datalog (data) {
        newdata = xmlToJson(data);
        console.log(newdata.rss.channel.item);
        gdata = newdata;
        return newdata.rss.channel.item;
      }
    });
  </script>


